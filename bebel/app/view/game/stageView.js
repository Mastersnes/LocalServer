define("jquery underscore app/utils/utils app/view/game/cinematiqueView app/data/stages.js app/view/game/playerView".split(" "),function(b,n,f,h,k,l){return function(g,m){this.init=function(a,b){this.el=".game";this.Textes=b;this.parent=a;this.mediatheque=a.mediatheque;this.pause=!1;this.player=new l(this)};this.go=function(a,d,e){b("#cinematique").show();this.cinematique||(this.cinematique=new h(this.Textes));this.map=k.get(a+d);if(this.map.end)this.map.cinematique?this.cinematique.load(this.map.cinematique):
b("#cinematique").hide(),g.gameOver(this.player.flag.point);else{this.mediatheque.stopAllMusic();this.map.music&&this.mediatheque.play(this.map.music);b(".game .background").attr("class","plan background "+a);b(".game .frontground").attr("class","plan frontground "+a);for(var c in this.map.elements){var f=this.map.elements[c];b(".game .stage").append(this.createElement(f,c))}for(c in this.map.back)f=this.map.back[c],b(".game .stage").append(this.createElement(f,c,"back"));c=this.player;e?(b("#cinematique").hide(),
c.load(e)):(this.map.cinematique?this.cinematique.load(this.map.cinematique):b("#cinematique").hide(),c.position.x=this.map.start.x,c.position.y=this.map.start.y);c.savePosition(a,d);c.reset();c.render();this.alreadyLoop||this.loop()}};this.gagne=function(){b(".game .stage").empty();b(".game").css({left:"0px"});this.go(this.map.gagne.lieu,this.map.gagne.stage)};this.load=function(a){this.go(a.lieu,a.stage,a)};this.createElement=function(a,d,e){e||(e="element");var c=b("\x3cdiv\x3e\x3c/div\x3e");c.attr("id",
a.id);a.ref&&c.attr("ref",a.ref);a.cible&&c.attr("cible",a.cible);a.vitesse&&c.attr("vitesse",a.vitesse);a.descente&&c.attr("descente",a.descente);a.distance&&c.attr("distance",a.distance);a.sens&&c.attr("sens",a.sens);a.sound&&c.attr("sound",a.sound);c.attr("index",d);c.attr("class",e+" "+a.id);c.css({left:a.x,top:a.y});return c};this.loop=function(){this.alreadyLoop=!0;if(!this.pause&&this.cinematique.empty()){var a=this.player;a.refresh();this.moveStage();a.flag.dead&&(a.flag.deathNb++,this.mediatheque.playSound("/slurp.mp3"),
a.flag.dead=!1,a.reset(),a.flag.move=0,a=-1*(a.position.x-300),0<a&&(a=0),b(".game").css({left:a+"px"},1E3))}var d=this;setTimeout(function(){d.loop()},30)};this.togglePause=function(a,d,e){(this.pause=!this.pause)?(a=f.encode(JSON.stringify(a)),b("#pause #code").html(a),b("#pause #point").html(d),b("#pause #deathNb").html(e),b("#pause").show()):b("#pause").hide()};this.moveStage=function(){if(0!=b("#player").length){var a=b(window).width(),d=b("#player").position().left,e=b(".game").position().left,
d=d+e;d>f.percent(a,50)?(a=d-f.percent(a,50),b(".game").css({left:"-\x3d"+a+"px"})):d<f.percent(a,30)&&0>e&&b(".game").css({left:"+\x3d5px"})}};this.init(g,m)}});